doctype html
html(lang='en')
  head
    title Transactions - PicoBudget - Expense tracking tool
    include includes/head.jade
  body
    include includes/dashboard_nav.jade
    .container
      section#content
        .row
          include includes/dashboard_sidebar.jade

          .span10
            h1 Transactions
            ul(style='padding-top:20px;').nav.nav-tabs#tabnav
              li#overviewlink
                a(href='#') Overview
              li#newlink
                a(href='#') New transaction
              li#transferlink
                a(href='#') Transfer
              li#tagslink
                a(href='#') Manage tags
            #overview
              h3 Transaction overview
              - if (flash.success !== undefined)
                .alert-success.alert#success
                  strong Well done!
                  br
                  p #{flash.success}
              - if (flash.error !== undefined)
                .alert-danger.alert#fail
                  strong Oh no..
                  br
                  p #{flash.error}
              - if (locals.transactions.length > 0)
                table.table.table-hover
                  thead
                    tr
                      th Date
                      th Account
                      th Descrition
                      th Tags
                      th(style='text-align:right;') Amount
                  tbody
                    for trans in locals.transactions
                      tr
                        td #{trans.date.toLocaleDateString()}
                        td
                          a(href='/account/#{trans.acc}/1') #{trans.acc}
                        td #{trans.name}
                        td
                          - if (trans.tags)
                            for tag in trans.tags
                              a(href='/tag/#{tag}/1') #{tag}&nbsp;
                        - if (trans.art === "+")
                          td(style='text-align:right;') #{functions.formatAmount(trans.amount)}
                        - else
                          td(style='text-align:right;') -#{functions.formatAmount(trans.amount)}
                ul.pager
                  - if (locals.page == 1)
                    li.previous.disabled
                      a(href="#") &larr; Newer
                  - else
                    li.previous
                      a(href="/transactions/#{locals.page - 1}") &larr; Newer
                  - if (locals.needsMorePages)
                    li.next
                      a(href="/transactions/#{locals.page + 1}") Older &rarr;
                  - else
                    li.next.disabled
                      a(href="#") Older &rarr;
              - else
                p There are no transactions to be displayed.
            #new
              h3 Add a new transaction
              - if (locals.accounts.length > 0)
                .alert-error.alert.hidden#fillInAllInfo
                  button.close(date-dismiss='alert') Ã—
                  strong Error!
                  br
                  p Please fill in all the information!
                form.form-horizontal(id='addtransactionform', method='POST', action='/transactionAdded', onsubmit="return PBHelperTools.validateAddTransaction();")
                  fieldset
                    .control-group#cg-id
                      .controls
                        input.input-xlarge#transIDInput(type='hidden', name='lastTransIDInput', value='#{locals.transactions.length}')
                    .control-group#cg-account
                      label.control-label(for='transAccDropdown') Account
                      .controls
                        select(name='transAccDropdown')
                          for account in locals.accounts
                            option(value='#{account.name}') #{account.name} - #{account.curr} #{functions.formatAmount(account.bal)}
                    .control-group#cg-name
                      label.control-label(for='transNameInput') Description
                      .controls
                        input.input-xlarge#transNameInput(type='text', name='transNameInput')
                    .control-group#cg-art
                      label.control-label(for='artDropdown') +/-
                      .controls
                        select(name='transArtDropdown')
                          option(value='+') +
                          option(value='-') -
                    .control-group#cg-transtags
                      label.control-label(for='transTagsInput') Tags
                      .controls
                        input.input-xlarge#transTagsInput(type='text', name='transTagsInput')
                        p
                          small Multiple tags can be entered with a space inbetween them.
                    .control-group#cg-transamount
                      label.control-label(for='transAmountInput') Amount
                      .controls
                        input.input-xlarge#transAmountInput(type='text', name='transAmountInput')
                    .control-group
                    .form-actions
                      button.btn.btn-info(type='submit') Add transaction
              - else
                p Please add a new account before adding a transaction.
            #transfer
              h3 Transfer
              form.form-horizontal(id='transferform', method='POST', action='/transferAdded', onsubmit="return PBHelperTools.validateAddTransfer();")
                fieldset
                  .control-group#cg-id
                    .controls
                      input.input-xlarge#transIDInput(type='hidden', name='lastTransIDInput', value='#{locals.transactions.length}')
                  .control-group#cg-account-from
                    label.control-label(for='transAccFromDropdown') from
                    .controls
                      select(name='transAccFromDropdown')
                        for account in locals.accounts
                          option(value='#{account.name}') #{account.name} - #{account.curr} #{functions.formatAmount(account.bal)}
                  .control-group#cg-account-to
                    label.control-label(for='transAccToDropdown') to
                    .controls
                      select(name='transAccToDropdown')
                        for account in locals.accounts
                          option(value='#{account.name}') #{account.name} - #{account.curr} #{functions.formatAmount(account.bal)}
                  .control-group#cg-transferamount
                    label.control-label(for='transferAmountInput') Amount
                    .controls
                      input.input-xlarge#transferAmountInput(type='text', name='transferAmountInput')
                  .form-actions
                    button.btn.btn-info(type='submit') Add transfer
            #tags
              h3 Tags
              - if (locals.tags.length > 0)
                table.table.table-hover
                  tbody
                    for tag, index in locals.tags
                      - if (index % 4 === 0)
                        tr
                      td
                        a(href='/tag/#{tag.name}/1') (#{tag.type}) #{tag.name}
              - else
                p There are not tags to be shown.
              hr
              h3(id='addtagtitle') Add a new tag
              form.form-horizontal(id='addtagform', method='POST', action='/tagAdded', onsubmit="return PBHelperTools.validateAddTag();")
                fieldset
                  .control-group#cg-tagName
                    label.control-label(for='tagNameInput') Name
                    .controls
                      input.input-xlarge#tagNameInput(type='text', name='tagNameInput')
                  .control-group#cg-tagType
                    label.control-label(for='tagTypeDropdown') Type
                    .controls
                      select(name='tagTypeDropdown')
                        option(value='+') +
                        option(value='-') -
                  .control-group
                  .form-actions
                    button.btn.btn-info(type='submit') Add tag

      include includes/footer.jade

    include includes/libs.jade

    script.
      (function() {
        PBHelperTools.toggleTransactionNavigationTabs();
      })();